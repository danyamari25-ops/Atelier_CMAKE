

# .github/workflows/tests.yml
 
name: Pipeline CI/CD
 
on: push
 
jobs:

  # ----------------------------------------------------

  # JOB 1 : COMPILATION

  # ----------------------------------------------------

  Compilation:

    runs-on: ubuntu-latest

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4
 
      - name: Installer CMake

        run: sudo apt-get update && sudo apt-get install -y cmake
 
      - name: Compilation et Tests CTest

        run: |

          mkdir build

          cd build

          cmake ..

          make

          ctest # ExÃ©cute tous les tests CTest (vÃ©rification globale)
 
  # ----------------------------------------------------

  # JOBS DE TESTS PARALLÃˆLES (DÃ©pendent de la compilation)

  # ----------------------------------------------------
 
  Test_Add:

    runs-on: ubuntu-latest

    needs: Compilation 

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4

      - name: Recompiler et Tester la fonction add

        run: |

          mkdir build; cd build; cmake ..; make

          ./src/calculator add 10 5 | grep "15"
 
  Test_Sub:

    runs-on: ubuntu-latest

    needs: Compilation 

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4

      - name: Recompiler et Tester la fonction sub

        run: |

          mkdir build; cd build; cmake ..; make

          ./src/calculator sub 10 5 | grep "5"
 
  # NOUVEAU JOB : Multiplication

  Test_Mul:

    runs-on: ubuntu-latest

    needs: Compilation 

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4

      - name: Recompiler et Tester la fonction mul

        run: |

          mkdir build; cd build; cmake ..; make

          ./src/calculator mul 5 5 | grep "25"
 
  # NOUVEAU JOB : Division

  Test_Div:

    runs-on: ubuntu-latest

    needs: Compilation 

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4

      - name: Recompiler et Tester la fonction div

        run: |

          mkdir build; cd build; cmake ..; make

          # Attention: la division de 1 par 5 donne 0.2. Le test doit le reflÃ©ter.

          ./src/calculator div 1 5 | grep "0.200000"
 
  Test_Carre:

    runs-on: ubuntu-latest

    needs: Compilation 

    steps:

      - name: Checkout du code

        uses: actions/checkout@v4

      - name: Recompiler et Tester la fonction carre

        run: |

          mkdir build; cd build; cmake ..; make

          ./src/calculator car 5 | grep "25"
 
  # ----------------------------------------------------

  # JOB FINAL : DÃ‰PLOIEMENT

  # ----------------------------------------------------

  Deploy:

    runs-on: ubuntu-latest

    # DÃ©pend de TOUS les 5 jobs de test pour s'assurer qu'ils ont tous rÃ©ussi

    needs: [Test_Add, Test_Sub, Test_Mul, Test_Div, Test_Carre] 

    steps:

      - name: DÃ©ploiement de la solution

        run: echo "ðŸŽ‰ DÃ©ploiement de la solution rÃ©ussi !"
 
